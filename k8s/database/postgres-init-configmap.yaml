apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-scripts
  namespace: medisupply
data:
  init-db.sql: |
    -- Script de inicializaci√≥n para PostgreSQL
    -- Crea las bases de datos necesarias para los microservicios
    
    -- Crear base de datos para suppliers si no existe
    DO $$
    BEGIN
      IF NOT EXISTS (SELECT 1 FROM pg_database WHERE datname = 'suppliers_db') THEN
        CREATE DATABASE suppliers_db;
      END IF;
    END
    $$;
    
    -- Conectar a la base de datos de suppliers y crear extensiones
    \c suppliers_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    
    -- Crear base de datos para users si no existe
    DO $$
    BEGIN
      IF NOT EXISTS (SELECT 1 FROM pg_database WHERE datname = 'users_db') THEN
        CREATE DATABASE users_db;
      END IF;
    END
    $$;
    
    -- Conectar a la base de datos de users y crear extensiones
    \c users_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    
    -- Crear base de datos para clients si no existe
    DO $$
    BEGIN
      IF NOT EXISTS (SELECT 1 FROM pg_database WHERE datname = 'clients_db') THEN
        CREATE DATABASE clients_db;
      END IF;
    END
    $$;
    
    -- Conectar a la base de datos de clients y crear extensiones
    \c clients_db;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    
    -- Mostrar bases de datos creadas
    \l
